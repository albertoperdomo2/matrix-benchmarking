#!/bin/bash

THIS_DIR=$(cd "$(dirname ${BASH_SOURCE[0]})">/dev/null 2>&1 && pwd)

thisfile_realpath=$(realpath "${BASH_SOURCE[0]}")
matrixbenchmark_basedir=$(dirname "$thisfile_realpath")/..
BASE_DIR=$(cd "${matrixbenchmark_basedir}" && pwd -P)

export PYTHONPATH="${PYTHONPATH}:${BASE_DIR}"

export MATBENCH_WORKLOAD=$(basename "$PWD")

if ! python -c "import sys,importlib.util; sys.exit(0 if importlib.util.find_spec('matrix_benchmarking.workloads.$MATBENCH_WORKLOAD') else 1)";
then
    echo "ERROR: the current directory '$PWD' ($MATBENCH_WORKLOAD) cannot be imported as a matrix-benchmarking workload"
    exit 1
fi


exec python -m matrix_benchmarking.main "$@"
